---
name: aletheia-self-pbt
description: Self-dogfooding workflow for the f4ah6o/aletheia.mbt MoonBit repo, covering PBT generation, template updates, and validation with moon tools. Use when modifying the analyzer/patterns/generator/cli pipeline or regenerating this repo's .pbt.mbt.md files.
---

# Aletheia Self PBT

## Overview

Generate or sync Aletheia's own PBT templates, then iterate on detection and templates until they are mbt check ready.

## Workflow

1. Generate or sync PBT templates
   - Full regenerate: run `./scripts/self_pbt.sh` from repo root.
   - Sync existing files: run `moon run src/aletheia -- sync ./src`.

2. Review generated files
   - Check `src/aletheia.pbt.mbt.md`, `src/cli/cli.pbt.mbt.md`, and `src/parser/parser.pbt.mbt.md` for template correctness.
   - Keep templates as `mbt nocheck` until the property logic is valid; switch to `mbt check` only after validating semantics.

3. Update detection/template logic
   - Pattern detection: `src/patterns/patterns.mbt`
   - Signature extraction/type inference: `src/analyzer/function_extractor.mbt`
   - Property templates: `src/generator/property_gen.mbt`
   - CLI wiring: `src/cli/main.mbt`

4. Verify
   - Run `moon test` (or `moon test --update` if snapshots intentionally change).
   - Review `*.mbti` diffs generated by `moon info`.
